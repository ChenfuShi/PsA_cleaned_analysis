#!/bin/bash --login
#$ -pe smp.pe 6
#$ -j y
#$ -o scratch/logs

##$ -l mem256 or -l mem512 #for high memory
##$ -l short
### for array jobs
#$ -t 21-23

##$ -M chenfu.shi@postgrad.manchester.ac.uk
##$ -m ae


INDEX=$((SGE_TASK_ID-1))

source activate personal_software

samples=(PSA4920_CD4_ARIMA
PSA4920_CD8_ARIMA
PSA4941_CD8_ARIMA
PSA4942_CD4_ARIMA
PSA4942_CD8_ARIMA
PSA4943_CD8_ARIMA
PSA4944_CD4_ARIMA
PSA4954_CD8_ARIMA
PSA4960_CD8_ARIMA
PSA4961_CD8_ARIMA
PSA4962_CD4_ARIMA
PSA4962_CD8_ARIMA
PSA4963_CD4_ARIMA
PSA4963_CD8_ARIMA
NRHV121_CD4_ARIMA
NRHV321_CD4_ARIMA
PsA4950_CD4_ARIMA
PsA4950_CD8_ARIMA
NRHV121_CD8_ARIMA
NRHV321_CD8_ARIMA
PsA4954_CD4_ARIMA
PsA4946CD8_ARIMA
PsA4969CD8SF_ARIMA
NRHV171CD8_ARIMA
PsA4958CD8_ARIMA
PsA4958CD4_ARIMA
NRHV171CD4_ARIMA
PsA5009CD4_ARIMA
PsA5009CD8_ARIMA
PsA4959CD4_ARIMA
PsA5013CD4_ARIMA
PsA5024CD8_ARIMA
PsA5037CD8_ARIMA
PsA5037CD4_ARIMA
PsA5018CD4_ARIMA
PsA5018CD8_ARIMA
PsA5019CD8_ARIMA
PsA5021CD4_ARIMA
NRHV324CD8_ARIMA
PsA5022CD8_ARIMA
PsA5017CD4_ARIMA
PsA5017CD8_ARIMA
PsA5021CD8_ARIMA
NRHV151CD4_ARIMA
NRHV324CD4_ARIMA
PsA5019CD4_ARIMA
PsA5020CD8_ARIMA
PsA5023CD8_ARIMA
PsA5026CD8_ARIMA
PsA4959CD8SF_ARIMA
PsA5006CD8_ARIMA
PsA4957CD4_ARIMA
PsA4968CD4_ARIMA
PsA4968CD8_ARIMA
PsA5006CD4_ARIMA
NRHV326CD4_ARIMA
NRHV326CD8_ARIMA
PsA5014CD4_ARIMA
PsA5007CD4_ARIMA
PsA5010CD8_ARIMA
PsA5013CD8_ARIMA
PsA5014CD8_ARIMA
PsA5015CD8_ARIMA
PsA5026CD4_ARIMA
NRHV322_CD8_ARIMA
NRSF055CD8SF_ARIMA
PsA4951_CD4_ARIMA
PSA4959_CD8_ARIMA
PSA4958CD8SF_ARIMA
PsA4951_CD8_ARIMA
NRHV238_CD8_ARIMA
NRHV322_CD4_ARIMA
PSA5010_CD4_ARIMA
PSA5025CD8SF_ARIMA
NRHV056CD8SF_ARIMA
NRHV073_CD4_ARIMA
NRHV073_CD8_ARIMA
NRHV238_CD4_ARIMA
NRHV295CD8_ARIMA
NRHV325CD4_ARIMA
NRHV079CD4_ARIMA
NRHV079CD8_ARIMA
NRHV295CD4_ARIMA
NRHV332CD4_ARIMA
NRHV332CD8_ARIMA
NRHV168CD8_ARIMA
NRHV290CD8_ARIMA
PsA5036CD8_ARIMA
NRHV290CD4_ARIMA
NRHV168CD4_ARIMA
PsA5040CD8_ARIMA
PsA5040CD8_SF_ARIMA
NRHV086CD8_ARIMA
NRHV086CD4_ARIMA
PSA4967CD4_ARIMA
NRHV325CD8_ARIMA
PSA4945CD4_ARIMA
NRHV014XCD4_ARIMA
NRHV014XCD8_ARIMA
psa4944CD8_ARIMA
PSA5039CD8_ARIMA
PSA5040CD4_ARIMA
PSA4951CD8SF_ARIMA
PSA5008_CD8_ARIMA
PSA5008_CD4_ARIMA
PSA5012_CD8_ARIMA
PSA5012_CD4_ARIMA
PSA4958CD4SF_ARIMA)

matching_pat=(PSA4920
PSA4920
PSA4941
PSA4942
PSA4942
PSA4943
PSA4944
PSA4954
PSA4960
PSA4961
PSA4962
PSA4962
PSA4963
PSA4963
NRHV121
NRHV321
PSA4950
PSA4950
NRHV121
NRHV321
PSA4954
PSA4946
PSA4969
NRHV171
PSA4958
PSA4958
NRHV171
PSA5009
PSA5009
PSA4959
PSA5013
PSA5024
PSA5037
PSA5037
PSA5018
PSA5018
PSA5019
PSA5021
NRHV324
PSA5022
PSA5017
PSA5017
PSA5021
NRHV151
NRHV324
PSA5019
PSA5020
PSA5023
PSA5026
PSA4959
PSA5006
PSA4957
PSA4968
PSA4968
PSA5006
NRHV326
NRHV326
PSA5014
PSA5007
PSA5010
PSA5013
PSA5014
PSA5015
PSA5026
NRHV322
PSA4917
PSA4951
PSA4959
PSA4958
PSA4951
NRHV238
NRHV322
PSA5010
PSA5025
PSA4918
NRHV073
NRHV073
NRHV238
NRHV295
NRHV325
NRHV079
NRHV079
NRHV295
NRHV332
NRHV332
NRHV168
NRHV290
PSA5036
NRHV290
NRHV168
PSA5040
PSA5040
NRHV086
NRHV086
PSA4967
NRHV325
PSA4945
NRHV014X
NRHV014X
PSA4944
PSA5039
PSA5040
PSA4951
PSA5008
PSA5008
PSA5012
PSA5012
PSA4958)

cd /net/scratch2/mdefscs4/HiC_splitting



~/communal_software/SNPsplit/SNPsplit-0.5.0/SNPsplit --hic --snp_file \
/mnt/iusers01/jw01/mdefscs4/psa_functional_genomics/PsA_combined_analysis/allele_specific_hic/allele_splitting/variant_files/${matching_pat[$INDEX]}_SNPsplit.txt.gz \
/net/scratch2/mdefscs4/master_HiC_analyzer_allele/hic-pro_outputs/${samples[$INDEX]}/bowtie_results/bwt2/${samples[$INDEX]}/${samples[$INDEX]}_merged_sorted.bam -o ${samples[$INDEX]} 


cd ${samples[$INDEX]}

samtools merge -n - ${samples[$INDEX]}_merged_sorted.G1_G1.bam ${samples[$INDEX]}_merged_sorted.G1_UA.bam | samtools sort > ${samples[$INDEX]}_G1_reads.bam 

samtools index ${samples[$INDEX]}_G1_reads.bam 

samtools merge -n - ${samples[$INDEX]}_merged_sorted.G2_G2.bam ${samples[$INDEX]}_merged_sorted.G2_UA.bam | samtools sort > ${samples[$INDEX]}_G2_reads.bam 

samtools index ${samples[$INDEX]}_G2_reads.bam 

# samtools sort ${samples[$INDEX]}_merged_sorted.UA_UA.bam > ${samples[$INDEX]}_UA_reads.bam 

# samtools index ${samples[$INDEX]}_UA_reads.bam 



target_dir=/mnt/iusers01/jw01/mdefscs4/psa_functional_genomics/PsA_combined_analysis/allele_specific_hic/allele_splitting/splitted_bams


cp ${samples[$INDEX]}_G1_reads.bam* $target_dir
cp ${samples[$INDEX]}_G2_reads.bam* $target_dir
# cp ${samples[$INDEX]}_UA_reads.bam* $target_dir

source activate personal_software
cd $target_dir
samtools sort -n ${samples[$INDEX]}_G1_reads.bam > ${samples[$INDEX]}_G1_reads_byname.bam

samtools sort -n ${samples[$INDEX]}_G2_reads.bam > ${samples[$INDEX]}_G2_reads_byname.bam

# samtools sort -n ${samples[$INDEX]}_UA_reads.bam > ${samples[$INDEX]}_UA_reads_byname.bam
